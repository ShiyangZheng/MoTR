name: Build and Deploy MoTR to shiyangzheng.github.io
on:
  push:
    branches:
      - main
      - master

jobs:
  build-and-deploy:
    strategy:
      matrix:
        folder:
          - MoTR/run_motr_in_magpie/attachment
          - MoTR/run_motr_in_magpie/provo
          - MoTR/run_motr_in_magpie/demo
          - MoTR/run_motr_in_magpie/demo-Clara
      fail-fast: false  # é˜²æ­¢ä¸€ä¸ªå¤±è´¥å¯¼è‡´å…¨éƒ¨å–æ¶ˆ

    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'  # ä½¿ç”¨ç¨³å®šçš„LTSç‰ˆæœ¬
          cache: 'npm'  # è‡ªåŠ¨ç¼“å­˜node_modules

      - name: Install and Build ğŸ”§
        run: |
          cd ${{ matrix.folder }}
          # æ£€æŸ¥æ˜¯å¦å­˜åœ¨lockæ–‡ä»¶
          if [ -f "package-lock.json" ] || [ -f "yarn.lock" ]; then
            npm ci --no-audit
          else
            npm install --no-audit
          fi
          npm run build

      - name: Verify Build Output
        run: |
          if [ ! -d "${{ matrix.folder }}/dist" ]; then
            echo "::error::Build failed to create dist directory in ${{ matrix.folder }}"
            exit 1
          fi

      - name: Deploy to shiyangzheng.github.io ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          repository-name: shiyangzheng/shiyangzheng.github.io  # ä½ çš„ç›®æ ‡ä»“åº“
          branch: main  # æˆ– gh-pagesï¼Œæ ¹æ®ä½ çš„Pagesè®¾ç½®
          folder: ${{ matrix.folder }}/dist
          target-folder: MoTR/${{ matrix.folder }}  # ä¿æŒåŸæœ‰è·¯å¾„ç»“æ„
          token: ${{ secrets.GITHUB_TOKEN }}
          clean: false  # ä¿ç•™ç›®æ ‡ä»“åº“å…¶ä»–æ–‡ä»¶
