name: Build and Deploy MoTR to shiyangzheng.github.io
on:
  push:
    branches:
      - main
      - master

jobs:
  build-and-deploy:
    strategy:
      matrix:
        folder:
          - MoTR/run_motr_in_magpie/attachment
          - MoTR/run_motr_in_magpie/provo
          - MoTR/run_motr_in_magpie/demo
          - MoTR/run_motr_in_magpie/demo-Clara

    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1

      - name: Read package.json versions
        uses: skjnldsv/read-package-engines-version-actions@v1.1
        id: versions
        with:
          path: ${{matrix.folder}}
          fallbackNode: '^12'
          fallbackNpm: '^6'

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: ${{ steps.versions.outputs.nodeVersion }}

      - name: Set up npm
        run: npm i -g npm@"${{ steps.versions.outputs.npmVersion }}"

      - name: Cache node modules
        uses: actions/cache@v1
        env:
          cache-name: cache-node-modules
        with:
          path: ~/.npm
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}-
            ${{ runner.os }}-build-
            ${{ runner.os }}-

      - name: Install and Build
        env:
          REPO_NAME: ${{ github.event.repository.name }}
        run: |
          cd ${{matrix.folder}}
          npm install
          npm run build

      - name: Deploy to shiyangzheng.github.io ğŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          # å…³é”®ä¿®æ”¹ï¼šéƒ¨ç½²åˆ°ä½ çš„ä¸ªäººPagesä»“åº“
          repository-name: shiyangzheng/shiyangzheng.github.io
          branch: main  # æˆ– gh-pagesï¼Œå–å†³äºä½ çš„Pagesè®¾ç½®
          folder: ${{ matrix.folder }}/dist
          target-folder: MoTR/${{ matrix.folder }}  # ä¿æŒåŸæœ‰è·¯å¾„ç»“æ„
          token: ${{ secrets.GITHUB_TOKEN }}
          clean: false  # ä¿ç•™ç›®æ ‡ä»“åº“å…¶ä»–æ–‡ä»¶
