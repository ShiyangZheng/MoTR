name: Deploy MoTR to My GitHub Pages
on:
  push:
    branches: [main, master]

jobs:
  deploy:
    strategy:
      matrix:
        folder: 
          - MoTR/run_motr_in_magpie/demo
          # 成功后可以添加其他目录：
          # - MoTR/run_motr_in_magpie/provo
          # - MoTR/run_motr_in_magpie/attachment

    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install and Build
        run: |
          cd ${{ matrix.folder }}
          echo "=== Building in $(pwd) ==="
          
          # 强制清理并安装
          rm -rf node_modules
          npm install --no-audit
          
          # 构建（失败时创建备用页面）
          npm run build || {
            echo "::warning::Build failed, creating fallback page"
            mkdir -p dist
            echo "<h1>临时页面</h1><p>构建失败但已部署</p>" > dist/index.html
          }

      - name: Deploy to shiyangzheng.github.io
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          repository-name: shiyangzheng/shiyangzheng.github.io
          branch: main  # 或你的Pages设置的分支（gh-pages/main）
          folder: ${{ matrix.folder }}/dist
          target
