name: Build and Deploy MoTR to shiyangzheng.github.io
on:
  push:
    branches:
      - main
      - master

jobs:
  build-and-deploy:
    strategy:
      matrix:
        folder:
          - MoTR/run_motr_in_magpie/attachment
          - MoTR/run_motr_in_magpie/provo
          - MoTR/run_motr_in_magpie/demo
          - MoTR/run_motr_in_magpie/demo-Clara

    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4  # æ›´æ–°åˆ°æœ€æ–°ç¨³å®šç‰ˆ

      - name: Read package.json versions
        uses: skjnldsv/read-package-engines-version-actions@v1.1
        id: versions
        with:
          path: ${{matrix.folder}}
          fallbackNode: '^16'  # æ›´æ–°é»˜è®¤Nodeç‰ˆæœ¬
          fallbackNpm: '^8'

      - name: Set up Node.js
        uses: actions/setup-node@v4  # æ›´æ–°åˆ°v4
        with:
          node-version: ${{ steps.versions.outputs.nodeVersion }}
          cache: 'npm'  # ä½¿ç”¨å†…ç½®ç¼“å­˜åŠŸèƒ½æ›¿ä»£æ—§ç‰ˆcache action

      - name: Install dependencies
        run: |
          cd ${{matrix.folder}}
          npm ci  # ä½¿ç”¨ciä»£æ›¿installç¡®ä¿ä¸€è‡´æ€§

      - name: Build
        run: |
          cd ${{matrix.folder}}
          npm run build

      - name: Deploy to shiyangzheng.github.io ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4  # æ›´æ–°åˆ°v4
        with:
          repository-name: shiyangzheng/shiyangzheng.github.io
          branch: main
          folder: ${{ matrix.folder }}/dist
          target-folder: MoTR/${{ matrix.folder }}
          token: ${{ secrets.GITHUB_TOKEN }}
          clean: false
